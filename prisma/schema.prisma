generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

// | Field          | Description             |
// | -------------- | ----------------------- |
// | profile_photo  | Profile image path      |
// | field_of_study | Faculty / field         |
// | degree_system  | LMD / Engineering       |
// | academic_year  | L1, L2, L3, M1, M2, PhD |
// | created_at     | Account creation date   |
// | updated_at     | Last update             |

model User {
  id           String  @id @default(uuid())
  firstName    String  @db.VarChar(25)
  lastName     String  @db.VarChar(25)
  username     String  @unique @db.VarChar(25)
  email        String  @unique @db.VarChar(254)
  passwordHash String  @db.Text
  bio          String? @db.VarChar(200)

  profilePhoto String? @db.VarChar(2048)

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt()
  refreshTokens RefreshToken[]
  posts         Post[]
  reactions     Reaction[]
  comments      Comment[]
}

model RefreshToken {
  id String @id @default(uuid())

  userId    String
  User      User     @relation(fields: [userId], references: [id])
  token     String   @unique
  expiresAt DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

enum PostType {
  QUESTION
  ANSWER
  ANNOUNCEMENT
  STUDY_TIP
  EXPLANATION
  RESOURCE
  PDF_RESOURCE
  SUMMARY
  AI_SUMMARY
  AI_QUESTION
  POLL
  DISCUSSION
  EVENT
}

model Post {
  id            String   @id @default(uuid())
  userId        String
  User          User     @relation(fields: [userId], references: [id])
  title         String?  @db.VarChar(150)
  content       String   @db.Text
  postType      PostType @default(DISCUSSION)
  reactionCount Int      @default(0)
  commentCount  Int      @default(0)

  isDeleted Boolean    @default(false)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt()
  reactions Reaction[]
  comments  Comment[]
}

enum ReactableType {
  POST
  COMMENT
}

enum ReactionType {
  LIKE
  HELPFUL
  EASY
  TOUGH
  FIRE
  MIND_BLOWN
}

model Reaction {
  id           String       @id @default(uuid())
  userId       String
  User         User         @relation(fields: [userId], references: [id])
  reactionType ReactionType @default(LIKE)

  postId String?
  post   Post?   @relation(fields: [postId], references: [id])

  commentId String?
  comment   Comment? @relation(fields: [commentId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

model Comment {
  id            String @id @default(uuid())
  postId        String
  post          Post   @relation(fields: [postId], references: [id])
  userId        String
  user          User   @relation(fields: [userId], references: [id])
  content       String @db.Text
  reactionCount Int    @default(0)
  repliesCount  Int    @default(0)

  isDeleted Boolean    @default(false)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt()
  reactions Reaction[]
}
